<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="^Wp4DQ:AyLopb.O[FQyq">run</variable><variable id="X`$+%P5zqr0J@c-V:KxA">lastTime</variable><variable id="g)i3Z=q#R]fvU!sfgZI~">home</variable><variable id="m7xXb|VYnkL%!g*4Zx:6">servo_range</variable><variable id="VPa#I3j8DTxHeMA0m$Of">mass_range</variable><variable id="AI^IY^.f](Ha_?Lx!O`a">kp</variable><variable id="]C_L?c6+z85u*ZW,PV6Z">kd</variable><variable id="]G$5SD}Ph[mG.KVO^[//">ki</variable><variable id="`k,j|[ORx.!qFA~FtJ#3">alpha</variable><variable id="X}{_VF@UQG{nTIuTuKX7">pid</variable><variable id=";pB]M8;12^k_kF:.~L*$">servoScaler</variable><variable id="G2[=F,Bn%Wx{5JisFle7">servo_angle</variable><variable id="-sN4_rH[!Zxz,)lTL;Pq">mass_angle</variable><variable id="HKiyR!CBS%Z1]eBGc#,e">meanAccel</variable><variable id="bTqv~ehm;yC.#oonG]XK">o</variable><variable id="}6NfPT!HMg~[!nrlBlnV">s</variable><variable id="2NTdsX+h/C-|;xn+)C`a">count</variable></variables><comment id="}v}Rd(`x9s_KPm-NP-OB" x="667" y="2833" w="480" h="120">
Using the range (-1000 to 1000 ) for both input and output
for to make it easy to interpret
</comment><comment id="pOMw9=/`~=a%c8sL-,2(" x="1192" y="2833" w="480" h="120">
Scale from the natural IMU output ( -1024 to 1024 ) to
more limited range
const imuScaler = makeScaler(-550, 550, -1000, 1000);
</comment><comment id="8g5qhvlO`r22@l2y}YhI" x="1717" y="2833" w="480" h="120">
Scale the output range to degrees for the servo
remember it is a 360 deg servo, but the control is for 180
const servoScaler = makeScaler(-mass_range, mass_range, (home - servo_range) / 2, (home + servo_range) / 2);
</comment><block type="pxt-on-start" id="cjkVi$N2aL9.:jdZTJ/#" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="}7/`jkKlD1j_95)^Wdv3"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let count = 0" numlines="1" declaredvars="count"></mutation><next><block type="typescript_statement" id="LEwCumyLg7,MECDi!Rlh"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let meanAccel = 0" numlines="1" declaredvars="meanAccel"></mutation><next><block type="typescript_statement" id="syni`~d{dFmQFq#q)rHW"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let a: number[] = []" numlines="1" declaredvars="a"></mutation><comment pinned="false" h="80" w="160">Initialize the array to hold the values</comment><next><block type="typescript_statement" id="]J1Oc5+!MG$D_xbJ3j~7"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let lastError = 0" numlines="1" declaredvars="lastError"></mutation><next><block type="typescript_statement" id="i(_oBq~qKjCSm?[?FVbF"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let integral = 0" numlines="1" declaredvars="integral"></mutation><next><block type="typescript_statement" id="l~?FY4KU(`bb*Q@=JKr("><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let servo = servos.P1" numlines="1" declaredvars="servo"></mutation><next><block type="typescript_statement" id="/Yu;0gS(PB@nyF,-@~Ns"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="function runningAvg(x: number, l: number = 4) {" line1="    // Add the new value to the end" line2="    a.push(x);" line3="" line4="    if (a.length &gt; l) {" line5="        a.shift();" line6="    }" line7="" line8="    // Calculate the sum" line9="    let sum = 0;" line10="    for (let i = 0; i &lt; a.length; i++) {" line11="        sum += a[i];" line12="    }" line13="" line14="    // Calculate the average" line15="    let average = sum / a.length;" line16="" line17="    // Return the average" line18="    return average;" line19="}" numlines="20"></mutation><next><block type="variables_set" id="7,[+8o(7W;:3wDZzOJ%Z"><field name="VAR" id="g)i3Z=q#R]fvU!sfgZI~">home</field><comment pinned="false" h="80" w="160">This is a 360degree servo</comment><value name="VALUE"><shadow type="math_number" id="N8YGX1Rqy1=LDe|;WKMe"><field name="NUM">180</field></shadow></value><next><block type="variables_set" id="uoo+B45bAsrPyOu@i{JH"><field name="VAR" id="m7xXb|VYnkL%!g*4Zx:6">servo_range</field><value name="VALUE"><shadow type="math_number" id="[7Jg[e-]At7!8*`N7lsx"><field name="NUM">75</field></shadow></value><next><block type="variables_set" id="zPCVBoysWFZxxjjHjZgg"><field name="VAR" id="VPa#I3j8DTxHeMA0m$Of">mass_range</field><value name="VALUE"><shadow type="math_number" id="~}PF/Xaogxp^Mt_0yvje"><field name="NUM">60</field></shadow></value><next><block type="variables_set" id=";g?462GLL~!:]z-U7m_p"><field name="VAR" id="AI^IY^.f](Ha_?Lx!O`a">kp</field><value name="VALUE"><shadow type="math_number" id="DFoamFqQFC_[-98AQJx~"><field name="NUM">0.5</field></shadow></value><next><block type="variables_set" id="WON#9vIpbg`kZI6Rc*X1"><field name="VAR" id="]C_L?c6+z85u*ZW,PV6Z">kd</field><value name="VALUE"><shadow type="math_number" id="rL*!bIV8}fKx$ha.]tvT"><field name="NUM">0.04</field></shadow></value><next><block type="variables_set" id="ha,V`GzG+j5GSU|l28*E"><field name="VAR" id="]G$5SD}Ph[mG.KVO^[//">ki</field><value name="VALUE"><shadow type="math_number" id="^:rH5_FX.bw!3TL!IqJp"><field name="NUM">0</field></shadow></value><next><block type="variables_set" id="us|r@N{sdO.F#/T9)EA="><field name="VAR" id="`k,j|[ORx.!qFA~FtJ#3">alpha</field><value name="VALUE"><shadow type="math_number" id="Zk8/;Oz_`x=u!_kxMDN0"><field name="NUM">0.3</field></shadow></value><next><block type="variables_set" id="PIJ-49@/H$;TkCZvQGX."><field name="VAR" id="X}{_VF@UQG{nTIuTuKX7">pid</field><value name="VALUE"><shadow type="math_number" id="YYenTTJxsRW17lv*(uN5"><field name="NUM">0</field></shadow><block type="function_call_output" id="Ld;fwCtRTeHna49Ebc!9"><mutation name="makePID" functionid="1P*R|x_s#A@cV+pdEI,;"><arg name="kp" id="ln5ymg24ir8nqg731fan" type="number"></arg><arg name="ki" id="ji0ns4p9k3kbb7mhh0c88" type="number"></arg><arg name="kd" id="npiqzx6hpuvdw2vacg0if" type="number"></arg><arg name="alpha" id="mum775ik2ilkom27ofnyf" type="number"></arg></mutation><value name="ln5ymg24ir8nqg731fan"><shadow type="math_number" id="3`sn|U{TM_Pjm/Rin2UQ"><field name="NUM">1</field></shadow><block type="variables_get" id="e7A]m8Rnf(@;L0BCr7tm"><field name="VAR" id="AI^IY^.f](Ha_?Lx!O`a">kp</field></block></value><value name="ji0ns4p9k3kbb7mhh0c88"><shadow type="math_number" id="gg??yosFa@ko_^VS]5Yy"><field name="NUM">1</field></shadow><block type="variables_get" id="7~r/^|7mQXI!qS~p(u5J"><field name="VAR" id="]G$5SD}Ph[mG.KVO^[//">ki</field></block></value><value name="npiqzx6hpuvdw2vacg0if"><shadow type="math_number" id="6NKb7/XM:GNlnmrS~_7b"><field name="NUM">1</field></shadow><block type="variables_get" id="[1SU8,`y]Eh,_+*{mSo3"><field name="VAR" id="]C_L?c6+z85u*ZW,PV6Z">kd</field></block></value><value name="mum775ik2ilkom27ofnyf"><shadow type="math_number" id="(wS4D;J.ik8l%h+j[gJv"><field name="NUM">1</field></shadow><block type="variables_get" id="A3T3YDS[{V}x*)FQ~^h]"><field name="VAR" id="`k,j|[ORx.!qFA~FtJ#3">alpha</field></block></value></block></value><next><block type="variables_set" id="0Fv]w^t+9rFRJ;Qg9ScO"><field name="VAR" id=";pB]M8;12^k_kF:.~L*$">servoScaler</field><comment pinned="false" h="80" w="160">This configuration just provides limits</comment><data>0;1;2</data><value name="VALUE"><shadow type="math_number" id="+.7ja@}~rIyh.S02:N/Z"><field name="NUM">0</field></shadow><block type="function_call_output" id="Ja25|N`.,/dBm/rPrwSX"><mutation name="makeScaler" functionid="e%gL2~Ly4a~Q_ZoT#P0$"><arg name="inputMin" id="ekvmltz7nv7oijgeguip" type="number"></arg><arg name="inputMax" id="ygsa761ljrbqr5egzvhy" type="number"></arg><arg name="outputMin" id="meyrvqq6qm39tmfpat8q" type="number"></arg><arg name="outputMax" id="a4hrlctvxg7dkotmc8ffs" type="number"></arg></mutation><value name="ekvmltz7nv7oijgeguip"><shadow type="math_number" id=".rh-nFw4i7-XaG{VbalI"><field name="NUM">1</field></shadow><block type="math_arithmetic" id="bX{`L.Z!Fa|p@6*vcpmr"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number" id="*$wZaV{6Tl!XJ12R0,pJ"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="()TM`XkNmBzHYdck`AW{"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="uuV1vrO,6pq3{e$4XT;a"><field name="NUM">0</field></shadow><block type="variables_get" id="w0Dg+7UiLs|ra08~)(Iu"><field name="VAR" id="g)i3Z=q#R]fvU!sfgZI~">home</field></block></value><value name="B"><shadow type="math_number" id="KLo(I:q=s%0K^rL8}6[M"><field name="NUM">0</field></shadow><block type="variables_get" id="khC](q^l?eIFZ+ti:-fB"><field name="VAR" id="m7xXb|VYnkL%!g*4Zx:6">servo_range</field></block></value></block></value><value name="B"><shadow type="math_number" id="-^1lGs.F!poiWb,6U#2Z"><field name="NUM">2</field></shadow></value></block></value><value name="ygsa761ljrbqr5egzvhy"><shadow type="math_number" id="FYo,q8n1*VQuX4M%@E}R"><field name="NUM">1</field></shadow><block type="math_arithmetic" id="EZt5,80t00@#1n@o+;YC"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number" id="Gt5]g^6,,nw[uCiEbqA3"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="_8Yd%.USJ],klo8AB!b:"><field name="OP">ADD</field><value name="A"><shadow type="math_number" id="IynP}.jiSzQ)]);i9j=:"><field name="NUM">0</field></shadow><block type="variables_get" id="_H1DH~o.L-=-76p;YI}Y"><field name="VAR" id="g)i3Z=q#R]fvU!sfgZI~">home</field></block></value><value name="B"><shadow type="math_number" id="N/n;AGqHSf_yQE:Em%cG"><field name="NUM">0</field></shadow><block type="variables_get" id="E9~#;E[0^AnO`TNQ+mEI"><field name="VAR" id="m7xXb|VYnkL%!g*4Zx:6">servo_range</field></block></value></block></value><value name="B"><shadow type="math_number" id="^6K?crrauwa8ez-F3`t2"><field name="NUM">2</field></shadow></value></block></value><value name="meyrvqq6qm39tmfpat8q"><shadow type="math_number" id="yc}fdS_~/b(!bsXPyzGF"><field name="NUM">1</field></shadow><block type="math_arithmetic" id="j/}UfNIx=^5|R%HB?0Ud"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number" id="]x=#E{RI3wgn!2P7Y;5F"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="INswQnq5X4_t-?F4HjN4"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="RPn(F|Qb)uY86Pd@myX5"><field name="NUM">0</field></shadow><block type="variables_get" id="GP7;DgH)x[g8$Hc[#dKY"><field name="VAR" id="g)i3Z=q#R]fvU!sfgZI~">home</field></block></value><value name="B"><shadow type="math_number" id="OSq]2LvfyxAk`Dlf9n,Z"><field name="NUM">0</field></shadow><block type="variables_get" id="L@qNGx8Siz)7m?(#?V-h"><field name="VAR" id="m7xXb|VYnkL%!g*4Zx:6">servo_range</field></block></value></block></value><value name="B"><shadow type="math_number" id="yZ#v-K/BJk]S2[DEcA]:"><field name="NUM">2</field></shadow></value></block></value><value name="a4hrlctvxg7dkotmc8ffs"><shadow type="math_number" id="h5aMLlN./.d!r3jx:~sL"><field name="NUM">1</field></shadow><block type="math_arithmetic" id="Pjg]3TH@-_P}zh_u+1p~"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number" id="`u{k:sI.q.CsYO0rLbh5"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="AN/hU#Q5{$l|:,M-tM}S"><field name="OP">ADD</field><value name="A"><shadow type="math_number" id="be5E)x*_x39x^*f%`B!-"><field name="NUM">0</field></shadow><block type="variables_get" id=",0n0IJDMw_@#?5$u=x$_"><field name="VAR" id="g)i3Z=q#R]fvU!sfgZI~">home</field></block></value><value name="B"><shadow type="math_number" id="2Ab.Ysl:=do[$2.4A#=n"><field name="NUM">0</field></shadow><block type="variables_get" id="]4QS6QUED$!0%`65CTc{"><field name="VAR" id="m7xXb|VYnkL%!g*4Zx:6">servo_range</field></block></value></block></value><value name="B"><shadow type="math_number" id="=VRt+5pKCZp#uEW.%B{q"><field name="NUM">2</field></shadow></value></block></value></block></value><next><block type="variables_set" id="9]zLy#DiCisQoln,8FL~"><field name="VAR" id="^Wp4DQ:AyLopb.O[FQyq">run</field><value name="VALUE"><shadow type="math_number" id="jUV2l?/SU8z7o^CZn1JQ"><field name="NUM">0</field></shadow><block type="logic_boolean" id="W~X(9P]5,vtX[-TE7iSU"><field name="BOOL">TRUE</field></block></value><next><block type="variables_set" id="_w*HMO,-Lq+i?fWLN;+4"><field name="VAR" id="G2[=F,Bn%Wx{5JisFle7">servo_angle</field><value name="VALUE"><shadow type="math_number" id="b61rS%C._O!HDhmAF~}u"><field name="NUM">0</field></shadow><block type="variables_get" id="0qAw:Cb/6j@j*4/__aA)"><field name="VAR" id="g)i3Z=q#R]fvU!sfgZI~">home</field></block></value><next><block type="setLightMode" id="$(7$m}D[OE/pFa(s@?je"><field name="mode">wuKong.LightMode.BREATH</field><next><block type="lightIntensity" id="-eP{(8mSkd7t3VboE`=S"><value name="light"><shadow type="math_number_minmax" id="%Y0H_uyS%|HSq:|sy?o]"><mutation min="0" max="100" precision="0"></mutation><field name="SLIDER">100</field></shadow></value><next><block type="device_while" id="y2}_!M,FBPum)rVByM?y"><value name="COND"><shadow type="logic_boolean" id="91mwT7lXgc/Bc9(!2kGV"><field name="BOOL">TRUE</field></shadow></value><statement name="DO"><block type="typescript_statement" id="yCTjS3)?@-v8C%,pU|h4"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="meanAccel = runningAvg(input.acceleration(Dimension.X))" numlines="1"></mutation><next><block type="variables_set" id="7CGj+Y4lbK8p7n2F%S;d"><field name="VAR" id="-sN4_rH[!Zxz,)lTL;Pq">mass_angle</field><value name="VALUE"><shadow type="math_number" id="S3x?+f:~0,uwqN]*?CRS"><field name="NUM">0</field></shadow><block type="function_call_output" id=":.3Rz[R_*kY#qkoa,iyP"><mutation name="radToDeg" functionid=";~%vF0jv]v8$X5_ZX`*G"><arg name="radians" id="66yetaan468zbs6snwg8c" type="number"></arg></mutation><value name="66yetaan468zbs6snwg8c"><shadow type="math_number" id="CvweS-LZ4ZGHTI~}bqFx"><field name="NUM">1</field></shadow><block type="math_js_op" id="np7H6A]jz!6E#IcKVa[t"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="unary"></mutation><field name="OP">asin</field><value name="ARG0"><shadow type="math_number" id="C~M27!4/,DTSDxL:S1aI"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="KhYVnD*6Gc-l*Uc1|jvq"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number" id="L%00IuvMiJ#ZPBeNHr6z"><field name="NUM">0</field></shadow><block type="variables_get" id="Q7F-7z-0v|Lz1P}i!gzx"><field name="VAR" id="HKiyR!CBS%Z1]eBGc#,e">meanAccel</field></block></value><value name="B"><shadow type="math_number" id="6OAOlBN|HEqj$D~`kCEX"><field name="NUM">1024</field></shadow></value></block></value></block></value></block></value><next><block type="serial_writevalue" id="(xRQ:wmFT2okUz8%hQor"><value name="name"><shadow type="text" id="uC`F,!@IAz21WwE5QkXG"><field name="TEXT">a</field></shadow></value><value name="value"><block type="variables_get" id="OyxAw7E#$t|sS1;i1M.W"><field name="VAR" id="-sN4_rH[!Zxz,)lTL;Pq">mass_angle</field></block></value><next><block type="typescript_statement" id="gk(XOj}V#:^:%MAPz/-["><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let o = pid(mass_angle)" numlines="1" declaredvars="o"></mutation><next><block type="serial_writevalue" id="X7^qr!eRK#=1$U2)Sj0y"><value name="name"><shadow type="text" id="+!dpj,5TJ(,Hh@hWqzmi"><field name="TEXT">o</field></shadow></value><value name="value"><block type="variables_get" id="`)7fNwARrJ=v6_.P1LKH"><field name="VAR" id="bTqv~ehm;yC.#oonG]XK">o</field></block></value><next><block type="variables_change" id="Wp6VgUWFn=,vdPmmm#P^"><field name="VAR" id="G2[=F,Bn%Wx{5JisFle7">servo_angle</field><value name="VALUE"><shadow type="math_number" id="k4eSF2KDz`Q/M$:jT~Pu"><field name="NUM">0</field></shadow><block type="variables_get" id="E#c)}%%3e)?*ly!QaeSI"><field name="VAR" id="bTqv~ehm;yC.#oonG]XK">o</field></block></value><next><block type="typescript_statement" id="+m`{!YSZa52Jm|I#}cBi"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let s = servoScaler(servo_angle)" numlines="1" declaredvars="s"></mutation><next><block type="controls_if" id="WUrRb3]tW[OwS2dL%Bv?"><value name="IF0"><shadow type="logic_boolean" id="%0|/i3v#PcIsOx}DADZz"><field name="BOOL">TRUE</field></shadow><block type="logic_negate" id="xY*lbZXj/):Dsdlg+0KY"><value name="BOOL"><shadow type="logic_boolean" id="ozOG9NmjoLZQns7L#|eG"><field name="BOOL">TRUE</field></shadow><block type="typescript_expression" id="Uj9|Y0uGW{.GBwo7y#/."><field name="EXPRESSION">Number.isNaN(s)</field></block></value></block></value><statement name="DO0"><block type="serial_writevalue" id="0V0i2QJl+-~:FGlI0cCr"><value name="name"><shadow type="text" id="llm~?3Kv2!HJH|wh*k;!"><field name="TEXT">s</field></shadow></value><value name="value"><block type="variables_get" id=")t3$/U{?+TD?2S,#XF_$"><field name="VAR" id="}6NfPT!HMg~[!nrlBlnV">s</field></block></value><next><block type="controls_if" id="[Vd2Ej;7zCp9c.5tC5lN"><mutation else="1"></mutation><comment pinned="false" h="80" w="160">servo.setAngle(s) // div 2 handled by scaler
servo.setAngle(home / 2) // b/c 360 deg</comment><value name="IF0"><shadow type="logic_boolean" id="j12{8A3Lg2O*:qv{*a^n"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="G|?[$WMJj4/ub!zCyZ~I"><field name="VAR" id="^Wp4DQ:AyLopb.O[FQyq">run</field></block></value></block></next></block></statement><next><block type="controls_if" id="89ty!:=XJwuj,3Ypm~J9"><value name="IF0"><shadow type="logic_boolean" id=",ohNeL(7yea3BE!tT-iY"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="8wpi3~3Z~7^{EWPU7Y2F"><field name="OP">EQ</field><value name="A"><shadow type="math_number" id="{e-peeYp1a{~FAV;Ztk/"><field name="NUM">0</field></shadow><block type="typescript_expression" id=":;YfEqL:#sg{[f.u4qn#"><field name="EXPRESSION">count--</field></block></value><value name="B"><shadow type="math_number" id="?(4@NF]{q6XDO#})7%#T"><field name="NUM">0</field></shadow></value></block></value><statement name="DO0"><block type="variables_set" id="?BeV,%)`qxVYj`?_Kccr"><field name="VAR" id="2NTdsX+h/C-|;xn+)C`a">count</field><value name="VALUE"><shadow type="math_number" id="8}f2byYsh`{pu|wPfo=)"><field name="NUM">1000</field></shadow></value><next><block type="device_pause" id="LEpI=tl!I(}#)9-C^fNl"><value name="pause"><shadow type="timePicker" id="|#3RawJ$oL*=dooO)|,}"><field name="ms">1</field></shadow></value></block></next></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="device_button_event" id="KBBg|mcrFk@fw53_w*8n" x="2151" y="0"><field name="NAME">Button.A</field><statement name="HANDLER"><block type="variables_set" id="QVRD0Yq66C*{84(=TFCW"><field name="VAR" id="^Wp4DQ:AyLopb.O[FQyq">run</field><value name="VALUE"><shadow type="math_number" id="=xR*8v^u+0j}w3%BQr2N"><field name="NUM">0</field></shadow><block type="logic_negate" id=".noZff5XrHOaqIIj.I,5"><value name="BOOL"><shadow type="logic_boolean" id="@0MJ*iR(lQf~tTF/_WWu"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id=".=;S]CYD(5LB9*84y1g@"><field name="VAR" id="^Wp4DQ:AyLopb.O[FQyq">run</field></block></value></block></value></block></statement></block><block type="function_definition" id="({!V8KrQWR#/xA52+A_D" x="2522" y="0"><mutation name="radToDeg" functionid=";~%vF0jv]v8$X5_ZX`*G"><arg name="radians" id="66yetaan468zbs6snwg8c" type="number"></arg></mutation><field name="function_name">radToDeg</field><value name="66yetaan468zbs6snwg8c"><block type="argument_reporter_number" id="-W,ni}vYNa*(+[6%Mrd%"><mutation duplicateondrag="true"></mutation><field name="VALUE">radians</field></block></value><statement name="STACK"><block type="function_return" id="oJbc9iGctwece_fJ`qDt"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number" id="-{GYL`{b2x|$J)z[aKnm"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="~/kJpQX2C[vq+5hJ^xnQ"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number" id="kXY~geiZ4*lu_kvq@;a{"><field name="NUM">0</field></shadow><block type="argument_reporter_number" id="Qtffi~WsnZ_6rM1gX:TS"><field name="VALUE">radians</field></block></value><value name="B"><shadow type="math_number" id="3EG3U9{6$;z)NgDevT6V"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="3b}6GJ~=nA8VBPUJ|2pB"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number" id="q+%j{7/}iBlVk[m$Q{A0"><field name="NUM">180</field></shadow></value><value name="B"><shadow type="math_number" id="1)Gf]F!NT(8pdxc_Yj1|"><field name="NUM">0</field></shadow><block type="typescript_expression" id="25W4;]%ebaItmT=?Svs4"><field name="EXPRESSION">Math.PI</field></block></value></block></value></block></value></block></statement></block><block type="function_definition" id="WvlPw%B-O+H7_;D#I4pY" x="3069" y="0"><mutation name="degToRad" functionid="bHzgG@VEkBdxQ~_KQ/|0"><arg name="degrees" id="z7306gt0gh0mk1jffs94h" type="number"></arg></mutation><field name="function_name">degToRad</field><value name="z7306gt0gh0mk1jffs94h"><block type="argument_reporter_number" id="g,)NJnqTfZ%D6#~]Xdkn"><mutation duplicateondrag="true"></mutation><field name="VALUE">degrees</field></block></value><statement name="STACK"><block type="function_return" id="kRl`v8#}xH:vX@)`10C_"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number" id="d%[y0mS1el9DzwA?FF$?"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="Urc;$ZbIh%pU5}F}LV!d"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number" id="kVgp+7SKuPD+]WkV?*N#"><field name="NUM">0</field></shadow><block type="argument_reporter_number" id="U,Dn}tQ,tQ}Y_$`?%t1y"><field name="VALUE">degrees</field></block></value><value name="B"><shadow type="math_number" id="ijuR@xZ-3$;{2O=|??|H"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="d[HJ/PyLckCj/EwaPWBv"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number" id="ysm]P51fq!p1bCKf{-eo"><field name="NUM">0</field></shadow><block type="typescript_expression" id="y#4$T3xx-e3CmCI,`HI)"><field name="EXPRESSION">Math.PI</field></block></value><value name="B"><shadow type="math_number" id="M!%C3h8]G/XkFN`yBhU@"><field name="NUM">180</field></shadow></value></block></value></block></value></block></statement></block><block type="function_definition" id="1#;J?Q;w))E55r;N?2in" x="3616" y="0"><mutation name="makeScaler" functionid="e%gL2~Ly4a~Q_ZoT#P0$"><arg name="inputMin" id="ekvmltz7nv7oijgeguip" type="number"></arg><arg name="inputMax" id="ygsa761ljrbqr5egzvhy" type="number"></arg><arg name="outputMin" id="meyrvqq6qm39tmfpat8q" type="number"></arg><arg name="outputMax" id="a4hrlctvxg7dkotmc8ffs" type="number"></arg></mutation><field name="function_name">makeScaler</field><value name="ekvmltz7nv7oijgeguip"><block type="argument_reporter_number" id="5{xJa8oTi2BrbL,#f;Y5"><mutation duplicateondrag="true"></mutation><field name="VALUE">inputMin</field></block></value><value name="ygsa761ljrbqr5egzvhy"><block type="argument_reporter_number" id="S3,6ledary}SdTE$}QaP"><mutation duplicateondrag="true"></mutation><field name="VALUE">inputMax</field></block></value><value name="meyrvqq6qm39tmfpat8q"><block type="argument_reporter_number" id="kz#2oN^Y?sKhp)|oS5IZ"><mutation duplicateondrag="true"></mutation><field name="VALUE">outputMin</field></block></value><value name="a4hrlctvxg7dkotmc8ffs"><block type="argument_reporter_number" id="oZmv}IY(`5=cIwAZ1@HN"><mutation duplicateondrag="true"></mutation><field name="VALUE">outputMax</field></block></value><statement name="STACK"><block type="function_return" id="ZZ%/Xy^ce-8**SYBhymZ"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><comment pinned="false" h="80" w="160">This inner function will have access to inputMin, inputMax, outputMin, outputMax</comment><value name="RETURN_VALUE"><shadow type="math_number" id="rl2xI!#2x$)qZ1{/`Z[#"><field name="NUM">0</field></shadow><block type="typescript_expression" id="wXYq_`JuB`BD?x6[=jy3"><field name="EXPRESSION">function (input: number): number {

        if (input &lt; inputMin) {
            return outputMin
        }

        if (input &gt; inputMax) {
            return outputMax
        }

        return ((input - inputMin) / (inputMax - inputMin)) * (outputMax - outputMin) + outputMin;
    }</field></block></value></block></statement></block><block type="function_definition" id="rMMAU.z}w7P/uF2)C1`}" x="0" y="2833"><mutation name="makePID" functionid="1P*R|x_s#A@cV+pdEI,;"><arg name="kp" id="ln5ymg24ir8nqg731fan" type="number"></arg><arg name="ki" id="ji0ns4p9k3kbb7mhh0c88" type="number"></arg><arg name="kd" id="npiqzx6hpuvdw2vacg0if" type="number"></arg><arg name="alpha" id="mum775ik2ilkom27ofnyf" type="number"></arg></mutation><field name="function_name">makePID</field><comment pinned="false" h="80" w="160">Creates a PID controller function.

@param {number} kp - Proportional gain
@param {number} ki - Integral gain
@param {number} kd - Derivative gain
@returns {(input: number) =&gt; number} - The PID function that takes the current error and returns the control output</comment><value name="ln5ymg24ir8nqg731fan"><block type="argument_reporter_number" id="I7;SWx;TB3?y[M~*@FDs"><mutation duplicateondrag="true"></mutation><field name="VALUE">kp</field></block></value><value name="ji0ns4p9k3kbb7mhh0c88"><block type="argument_reporter_number" id="uvzOTc8DqpziT!gjcS_V"><mutation duplicateondrag="true"></mutation><field name="VALUE">ki</field></block></value><value name="npiqzx6hpuvdw2vacg0if"><block type="argument_reporter_number" id="=fCXXxPrBe=~Ab,^6N6S"><mutation duplicateondrag="true"></mutation><field name="VALUE">kd</field></block></value><value name="mum775ik2ilkom27ofnyf"><block type="argument_reporter_number" id="xGI:4h8Gq.oxsMr_Q0vv"><mutation duplicateondrag="true"></mutation><field name="VALUE">alpha</field></block></value><statement name="STACK"><block type="variables_set" id="a#*(S]2vruS;LX0Bp]R/"><field name="VAR" id="X`$+%P5zqr0J@c-V:KxA">lastTime</field><value name="VALUE"><shadow type="math_number" id="_YZpaP[xVgT;LJaSO+MN"><field name="NUM">0</field></shadow><block type="control_running_time" id="Z9A+=k`.ULDr{Fi:T~z+"></block></value><next><block type="function_return" id="p^h~S;D@lRBc=Fh44c}:"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number" id="V#-_`M=ImI$|;/PTv6$Y"><field name="NUM">0</field></shadow><block type="typescript_expression" id="gRF0]L1oL{t[sR;1K;Su"><field name="EXPRESSION">function (error: number) {
        const now = control.millis();
        const dtMs = now - lastTime;
        const dt = dtMs / 1000; // Convert ms to seconds

        if(Number.isNaN(error)){
            error = lastError
        }


        // Defensive: avoid division by zero
        const safeDt = dt &gt; 0 ? dt : 1e-3;

        integral += error * safeDt;

        let filteredError = alpha * error + (1 - alpha) * lastError;

        if (Number.isNaN(filteredError)){
            filteredError = error

        }

        const derivative = (filteredError - lastError) / dt;

        const output = kp * error + ki * integral + kd * derivative;

        lastError = error;
        lastTime = now;

        return output;
    }</field></block></value></block></next></block></statement></block></xml>